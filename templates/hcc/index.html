{% extends 'hcc/base.html' %}

{% block title %}<a href="/v1/">Harvester Control Center</a>{% endblock %}

{% block content %}
<div class="container">
    {% if user.is_authenticated %}
    <div class="row">
        <div class="col-sm">
            <div class="card">
              <h3 class="card-header">Register new Harvester</h3>

              <div class="card-body">
                <a href="{% url 'api:hreg-form' %}" id="reg-button"><i class="fa fa-plus-circle fa-5x" aria-hidden="true"></i></a>
                <a href="{% url 'api:hreg-form' %}" data-toggle="modal" data-target="#form-modal">Register</a>
              </div>
            </div>
        </div>
        <div class="col-sm">
            <div class="card">
              <h3 class="card-header">Deploy new Harvester</h3>

              <div class="card-body">
                <a href="#"><i class="fa fa-cloud-download fa-5x" aria-hidden="true"></i></a>
              </div>
            </div>
        </div>
      </div><br>
      {% if harvesters|length > 0 %}
      <div class="row">
          {% for harvester in harvesters %}
              <div class="col-md-4">
                  <div class="card">

                    <h3 class="card-header">
                      {% if harvester.enabled %}
                        <a href="{% url 'toggle_harvester' name=harvester.name %}" type="button" class="btn btn-success btn-sm"><i class="fa fa-toggle-on" aria-hidden="true"></i></a>
                        <span class="badge badge-success">
                          {{ harvester.name|lower|capfirst }}
                        </span>
                      {% else %}
                        <a href="{% url 'toggle_harvester' name=harvester.name %}" type="button" class="btn btn-secondary btn-sm"><i class="fa fa-toggle-off" aria-hidden="true"></i></a>
                        <span class="badge badge-secondary">
                          {{ harvester.name|lower|capfirst }}
                        </span>
                      {% endif %}
                      <a href="{{ harvester.url }}/harvest/" type="button" class="btn btn-primary btn-sm" data-toggle="button" aria-pressed="false" autocomplete="off">
                        <i class="fa fa-play-circle" aria-hidden="true"></i>
                      </a>

                      <a href="{% url 'api:harvester-detail' name=harvester.name %}">Harvester</a>
                    </h3>

                    <div class="card-body">
                      {% for k, val in status.items %}
                          {% if k == harvester.name %}
                            {% if val.status == 'harvesting' %}
                            <div class="progress">
                              <div class="progress-bar w-{{ val.progress_cur }}" role="progressbar" aria-valuenow="{{ val.progress_cur }}" aria-valuemin="0" aria-valuemax="{{ val.progress_max }}"></div>
                            </div>
                            {% endif %}
                          {% endif %}
                      {% endfor %}

                      <p>Metadata: {{ harvester.metadataPrefix }}</p>
                      <p>API: <a href="{{ harvester.url }}/harvest">{{ harvester.url }}</a></p>
                      <p>Status:
                        {% for k, val in status.items %}
                            {% if k == harvester.name %}
                            {{ val }}
                            {% endif %}
                        {% endfor %}</p>
                      <p></p>
                    </div>
                  </div><br>
              </div>

          {% endfor %}
      </div>
      {% else %}
          <div class="alert alert-info" role="info">Register a new Harvester via API.</div>
      {% endif %}

    {% else %}
      <div class="alert alert-warning" role="alert">You are not logged in ..</div>
    {% endif %}

</div>

<div id="form-modal" class="modal fade" tabindex="" role="dialog">
 <div class="modal-dialog modal-dialog-centered" role="document">
   <div class="modal-content">
     <div class="modal-header">
         <h4 class="modal-title">Modal title</h4>
         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
     </div>
     <div id="form-modal-body" class="modal-body">
         ...
     </div>
     <div class="modal-footer">
       <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
       <button type="button" class="btn btn-primary">Save changes</button>
     </div>
   </div><!-- /.modal-content -->
 </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{% endblock %}
